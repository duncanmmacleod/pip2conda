# -- UV template

.uv:
  image: ghcr.io/astral-sh/uv:debian
  variables:
    UV_CACHE_DIR: "${CI_PROJECT_DIR}/.cache/uv"
    UV_MANAGED_PYTHON: 1
  after_script:
    - uv cache prune --ci
  cache:
    key: "uv-${CI_JOB_NAME_SLUG}"
    paths:
      - .cache/uv
  retry:
    # retry all jobs at most twice when gitlab-ci fails to start the job properly
    # see https://docs.gitlab.com/ee/ci/yaml/#retry
    max: 2
    when:
      - runner_system_failure
